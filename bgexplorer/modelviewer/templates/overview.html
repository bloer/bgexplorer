{% extends "modelbase.html" %}

{% block title %}Overview: {{ longname }}{% endblock %}

{% block pageheader %}
    <h1 style="display:inline-block">{{ g.model.name }} <small>v{{ g.model.version }}</small></h1>
    Last modified on {{ g.model.editDetails.get('date') }} by {{ g.model.editDetails.get('user') }}

    <div class="btn-group pull-right">
        <a class="btn btn-default" href="{{ url_for('.export') }}">Export as JSON</a>
        <a class="btn btn-primary" href="{{ url_for('modeleditor.bindsimdata',modelid=g.model.id) }}" >Update simulation data</a>
        <form class="form-inline" action="{{ url_for('modeleditor.newmodel') }}" method="POST" style="display:inline" >
            <input type="hidden" name="derivedFrom" value="{{ g.model.id }}">
            <button class="btn btn-warning" type="submit" >Edit (New Version)</button>
        </form>


    </div>
{% endblock %}

{% block pagecontent %}
    <div class="row" >
    <div class="col-md-6" >
        <h3>Description</h3>
        <p>{{ g.model.description }}</p>
        <h4>Database Backend</h4>
        <p><a href="{{ url_for('simsviewer.overview') }}">{{ g.model.simsdb |default("default") }}</a></p>
        <h4>Calculations and Spectra generation status</h4>
        {%- if evalcachestatus  %}
            <form class="form-inline" action="{{ url_for('.evaldata') }}" method="POST">
                <button class="btn btn-success">Generate</button>
            </form>
        {% else %}
        <p> {{ evalcachestatus }}</p>
        {% endif %}

        <h3>Additional Details</h3>
        <dl class="dl-horizontal" >
        {% for key, val in g.model.editDetails.items() %}
        {% if key not in ("date", "user", "derivedFrom") %}
            <dt class="" >{{ key }}</dt>
            <dd class="" >{{ val }}</dd>
        {% endif %}
        {% endfor %}
        </dl>
    </div><!-- end col -->

    <div class="col-md-6" >
        <dl class="dl-horizontal" >
            <dt>Total <a href="{{ url_for('.componentview') }}">components</a>: </dt>
            <dd>{{ g.model.components | length }}</dd>

            <dt>Total <a href="{{ url_for('.emissionsoverview') }}">emission specs</a>:</dt>
            <dd>{{ g.model.specs | length }}</dd>
        </dl>
    </div>
    </div> <!-- end row -->

    <div class="row" >
    <div class="col-md-12" >
        {% if history %}
        <h3>History</h3>
        <table id="historytable" class="table table-compact">
            <thead>
                <tr><th>Name</th><th>Comment</th><th>Saved</th></tr>
            </thead>
            <tbody>
            {% for oldmodel in history %}<tr>
                <td><a href="{{ url_for('.overview', model=oldmodel, permalink=True) }}">
                    {{ oldmodel['name'] }} v{{ oldmodel['version'] }}</a>{%- if loop.index0==0 %} (this version){%- endif -%}</td>
                <td>{{ oldmodel['editDetails']['comment'] }}</td>
                <td>{{ oldmodel['editDetails']['date'] }} by {{ oldmodel['editDetails']['user'] }}</td>
            {% endfor %}</tr>

            </tbody>
        </table>
        {% endif %}
    </div><!-- end col -->
    </div> <!-- end row -->
{% endblock %}
