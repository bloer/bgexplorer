{% extends "modelbase.html" %}

{% set class = "Component" %}
{% if component.components is defined %}
    {% set class = "Assembly" %}
{% endif %}

{% block mystyles %}
<style>
 tr.spec { background-color:rgb(245, 245, 245) }
 tr.subspec { background-color:initial }
 tr.subspec td:first-child { padding-left: 2em; }
 tr.simdata td:first-child { padding-left: 4em; }
 
</style>
{% endblock %}

{% block title %}Component: {{ component.name }}{% endblock %}

{% block pageheader %}
    <h1> <small>{{ class }}: </small>{{ component.name }}</h1>
{% endblock %}



{% macro speccells(spec, link=true) %}
    <td>{% if link %}<a href="{{ url_for('.emissionview', spec=spec) }}">{% endif %}
	{{ spec.name }}
    {% if link %}</a>{% endif %}</td>
    <td>{{ spec.category }}</td>
    <td>{{ spec.distribution }}</td>
    <td>{{ spec.getratestr(2) }}</td>
{% endmacro %}

{% macro printsimdata(spec, simdata) %}
{% for simd in simdata %}{% if simd.spec == spec and simd.matches %}
    <tr class="simdata" >
	<td colspan="5" >
	    Simdata: Emission rate = {{ "{:.3e}".format(simd.emissionrate.to('1/day').m) }}/day. 
	    {% for match in simd.matches %} 
		<a href="{{ url_for('.simdatamatchview', match=match) }}">
		    Query {{ loop.index }}
		</a>: {{ match.livetime.to('day') }}
	    {% endfor %}
	</td>
    </tr>
{% endif %}{% endfor %}
{% endmacro %}

{% block pagecontent %}
    <div class="row">
	<div class="col-md-6">
	    <h2> General Info </h2>
	    <dl class="dl-horizontal" >
		<dt>Description</dt><dd>{{ component.description or 'None'}}</dd>
		{% if component.comment %}<dt>Comment</dt><dd>{{ component.comment }}</dd>{% endif %}
		{% if component.querymod %}<dt>Query modifier</dt><dd>{{ component.querymod }}</dd>{% endif %}
		{% for key, val in component.moreinfo.items() %}
		    <dt>{{ key }}</dt> <dd>{{ val | urlize }}</dd>
		{% endfor %}
	    </dl>
	    
	    <h2>Physical Characteristics</h2>
	    <dl class="dl-horizontal"">
		{% for val in ['material','mass','surface_in','surface_out', 'surface_interior', 'volume'] %}
		    <dt>{{ val }}</dt><dd>{{ component | attr(val) }}</dd>
		{% endfor %}
	    </dl>
	</div> <!-- end first column -->
	
	<div class="col-md-6">

	    <h2>Placements <small>Total weight: {{ component.gettotalweight(g.model.assemblyroot) }}</small></h2>
	    {% for path in g.model.assemblyroot.gethierarchyto(component,placements=True) or [] %}
		<ol class="breadcrumb placementpath">{% for step in path %}
		    {% if loop.index0 == 0 %}
			<li class="breadcrumb-item">
			    <a href="{{ url_for('.componentview', component=step.parent) }}">
				{{ step.parent.name }}
			    </a>
			</li>
		    {% endif %}
		    {% if loop.revindex0 > 0 %}
			<li class="breadcrumb-item">
			    <a href="{{ url_for('.componentview', component=step.component) }}">
				{{ step.component.name }}{%- if step.weight != 1 %} ({{ step.weight }}){%- endif -%}
			    </a>
			</li>
		    {% else %}
			<li class="breadcrumb-item active">
			    {{ step.component.name }}{%- if step.weight != 1 %} ({{ step.weight }}){%- endif -%}
			</li>
		    {% endif %}
		{% endfor %}</ol>
	    {% endfor %}
	    
	    {% if component.components %}
		<h2>Subcomponents</h2>
		<table id="subcomponents" class="table table-compact">
		    <thead>
			<tr><th>Name</th><th>Weight</th><th>Query Modifier</th></tr>
		    </thead>
		    <tbody>{% for placement in component.components %}
			<tr class="placement" >
			    <td><a href="{{ url_for('.componentview',component=placement.component) }}">
				{{ placement.component.name }}</a></td>
			    <td>{{ placement.weight }}</td>
			    <td>{{ placement.querymod | default('',true) }}</td>
			</tr>
		    {% endfor %}</tbody>
		</table>
	    {% endif %}
	    
	    
	</div> <!-- end second column -->
    
    </div><!-- end 'row' -->

    {% if component.specs %}
    <h2>Emission specs</h2>
    <table id="specstable" class="table table-compact">
	<thead>
	    <tr>
		<th>Name</th><th>Type</th><th>Dist.</th><th>Rate</th><th>Query Mod.</th>
	    </tr>
	</thead>
    {% for boundspec in component.specs %}
	<tr class="spec" >
	    {{ speccells(boundspec.spec,link=True) }}
	    <td>{% if boundspec.querymod %}Querymod: {{ boundspec.querymod }}{% endif %}</td>
	</tr>
	{{ printsimdata(boundspec.spec, boundspec.simdata) }}
	{% if boundspec.spec.subspecs %}{% for subspec in boundspec.spec.subspecs %}
	    <tr class="spec subspec">
		{{ speccells(subspec, link=False) }}
		<td></td>
	    </tr>
	    {{ printsimdata(subspec, boundspec.simdata) }}
	{% endfor %}{% endif %}
    {% endfor %}
    {% endif %}
    
{% endblock %}
