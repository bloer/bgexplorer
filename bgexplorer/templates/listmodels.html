{% extends "base.html" %}

{% block title %}List Models{% endblock %}

{% block mystyles %}
    <style>
     tbody.oldversions {color:gray; font-style:italic;}
     tbody.oldversions tr td:first-child {padding-left:1em; }
     button[data-toggle="collapse"]::after { content:"▲"}
     button[data-toggle="collapse"].collapsed::after {content:"▼"}
     form.form-inline {display: inline}
    </style>
{% endblock %}


{% macro newmodelbutton(derivedFrom='', label="Edit", class="") -%}
    <form action="{{ url_for('modeleditor.newmodel') }}" class="form-inline" method="POST">
	{% if derivedFrom -%}
	    <input type="hidden" name="derivedFrom" 
		   value="{{ derivedFrom }}">
	{%- endif -%}
	<button type="submit" class="btn btn-primary btn-sm {{ class }}">{{ label }}</button>
    </form>
{%- endmacro %}


{% macro printmodel(model, expandtarget, class="", permalink=true) %}
    <tr class="model {{ class }}">
	<td><a href="{{ url_for('modelviewer.overview', model=model, permalink=permalink) }}">{{ model['name'] }}</a></td>
	<td>{{ model['version'] }}
	    {%- if expandtarget %} 
		<button class="btn btn-default btn-xs collapsed" data-toggle="collapse" data-target="#{{ expandtarget }}" ></button>
	    {%- endif -%}
	</td>
	<td>{{ model['description'] }}</td>
	<td>{{ model['editDetails']['date'] }} by {{ model['editDetails']['user'] }}</td>
	<td>{{ model['editDetails']['comment'] }}</td>
	<td>{{ newmodelbutton(model['_id']) }}</td>
    </tr>
{% endmacro %}


{% block pageheader %}
    <h1>List of Models</h1> 
    <button class="btn btn-primary" data-toggle="modal" data-target="#newmodeldialog" >Create New</button>
{% endblock %}


    

{% block pagecontent %}
    <div id="newmodeldialog" class="modal fade" ><div class="modal-dialog" ><div class="modal-content" >
        <div class="modal-header" >
            <button type="button" class="close" data-dismiss="modal">&times;</button>
		    <h4 class="modal-title">New Model</h4>
		</div>
        <div class="modal-body clearfix">
            <form id="newmodelform" class="" action="{{ url_for('modeleditor.newmodel') }}" method="POST" 
                  enctype="multipart/form-data">
                <div class="form-group" >
                    <label for="newmodelname" class="control-label" >Name</label>
                    <input type="text" name="name" id="newmodelname" class="form-control" >
                </div>
                <div class="form-group" >
                    <label for="import" class="control-label" ><small>Optional:</small> Import JSON file</label>
                    <input type="file" name="import" id="import" accept=".json,.txt" >
                </div>
                <button class="btn btn-success pull-right" type="submit">Submit</button>
            </form>
        </div>
        
        <!-- 
        <div class="modal-footer" >
            <button class="btn btn-default" data-dismiss="modal" >Cancel</button> 
        </div>
        -->
        
    </div></div></div>
    
    
    <table id="modelist" class="table" >
	<thead>
	    <tr>
		<th>Name</th><th>Version</th><th>Description</th>
		<th>Last Edited</th><th>Comment</th><th></th>
	    </tr>
	</thead>
	{% for name, models in modelgroups %}
	    {% if models | length > 1 %}
		{% set target="modelgroup-"+name|replace(" ","_") %}
	    {% else %}
		{% set target=none %}
	    {% endif %}
	    {% for model in models %}
		{% if loop.index0 == 0 %}
		    <tbody> {{ printmodel(model, target, permalink=false) }} </tbody>
		{% else %}
		    {% if loop.index0 == 1 %}<tbody id="{{ target }}" class="collapse oldversions" >{% endif %}
			{{ printmodel(model) }}
		    {% if loop.revindex0 == 0 %}</tbody>{% endif %}    
		{% endif %}
	    {% endfor %}
	{% endfor %}
    </table>
    
{% endblock %}
